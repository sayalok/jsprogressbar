<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Progress Bar</title>
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
	</head>
	<body>

		<form id="uploadForm" method="post">
			<div class="form-group">
				<label for="exampleInputFile">Choose File</label>
				<input type="file" name="inpFile" id="inpFile">
			</div>
			<input type="submit" class="btn btn-default" value="Upload">
		</form>

		<div class="progress" id="progress" style="display: none">
			<div 
					class="progress-bar" role="progressbar" 
					aria-valuenow="60" aria-valuemin="0" 
					aria-valuemax="100" style="width: 0%;" id="progress-bar">
				0%
			</div>
		</div>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

		<script type="text/javascript">
				const uploadForm  = document.getElementById("uploadForm") 
				const inpFile     = document.getElementById('inpFile')
				const progressbar = document.getElementById('progress-bar')
				const progress = document.getElementById('progress')

				// uploadForm.addEventListener("submit", uploadFile)

				// function uploadFile(e) {
				//   e.preventDefault();

				//   const xhr = new XMLHttpRequest();
				//   xhr.open('POST','upload.php')
				//   xhr.upload.addEventListener("progress", e => {
				//     const percent = (e.loaded / e.total) * 100
				//     progressbar.innerHTML = percent.toFixed(2) + '%'
				//     progressbar.style.width = percent + '%'
				//     console.log(e.loaded)
				//   })

				//   xhr.setRequestHeader('Content-type','multipart/form-data');
				//   xhr.send(new FormData(uploadForm))
				// }

				$('#uploadForm').submit(function (e) {
					  e.preventDefault();
					  $.ajax({
  						xhr: function() {
					    var xhr = new window.XMLHttpRequest();

    					xhr.upload.addEventListener("progress", function(evt) {
      				if (evt.lengthComputable) {
      					progress.style.display = ''
        				var percent = evt.loaded / evt.total;
				        percent = parseInt(percent * 100);
				        progressbar.innerHTML = percent.toFixed(2) + '%'
				     		progressbar.style.width = percent + '%'
				     		console.log(percent)
      				}
				    }, false);
				    return xhr;
				  },
  				url: 'upload.php',
  				method: 'post',
          processData: false,
          contentType: false,
          cache: false,
          enctype: 'multipart/form-data',
  				type: "POST",
				  data: new FormData(this),
				  dataType: "json",
				  success: function(result) {
				    console.log(result);
				  }
				});


					  // const xhr = new XMLHttpRequest();
					  // xhr.open('POST','upload.php')
					  // xhr.upload.addEventListener("progress", e => {
					  //   const percent = (e.loaded / e.total) * 100
					  //   progressbar.innerHTML = percent.toFixed(2) + '%'
					  //   progressbar.style.width = percent + '%'
					  //   console.log(e.loaded)
					  // })

					  // xhr.setRequestHeader('Content-type','multipart/form-data');
					  // xhr.send(new FormData(uploadForm))
				})

		</script>
	</body>
</html>